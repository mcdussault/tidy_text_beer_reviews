library(knitr)
library(ggplot2)
library(tidytext)
library(tidyr)
library(dplyr)
library(magrittr)
library(corrplot)
library(class)
library(caret)
knitr::opts_chunk$set(echo = FALSE, warning=F, error=F, message=F)
beer <- read.csv("brewery_beers.csv", stringsAsFactors=F)
beer_reviews <- read.csv("brewery_beers_reviews.csv", stringsAsFactors=F)
beer_reviews <- merge(beer, beer_reviews, by="Beer_URL", all.x=T)
beer_reviews <- beer_reviews[!duplicated(beer_reviews[,c(1:9)]),]
# custom plot theme
theme_kp <- function(){
theme_classic(base_size=10, base_family="Avenir") %+replace%
theme(
plot.title=element_text(size=18, face="bold", family="Avenir"),
panel.background  = element_blank(),
legend.background = element_rect(fill="transparent", colour=NA),
legend.key = element_rect(fill="transparent", colour=NA)
)
}
st <- data.frame(table(beer$Style)) %>%
set_colnames(c("Style", "Num")) %>%
mutate(Proportion = Num/sum(Num),
Measure = "Number of Profiles") %>%
top_n(50, Num) %>%
arrange((Num)) %>%
mutate(Style = factor(Style, levels=Style))
reviews <- aggregate(Ratings ~ Style, beer, sum) %>%
set_colnames(c("Style", "Num")) %>%
mutate(Proportion = Num / sum(Num),
Measure = "Total Ratings") %>%
subset(Style %in% st$Style)
st1 <- rbind(st, reviews)
s10 <- st %>% top_n(10, Num)
beer_names <- unique(c(strsplit(tolower(paste(gsub("[[:punct:]]", "", beer_reviews$Style), collapse=" ")), " | / ")[[1]],
"marzen", "kolsch", "hefe", "triple", "dopplebock"))
exceptions <- c("extra", "strong", "bitter", "oatmeal", "brown", "heavy", "dry", "black", "mild", "amber", "red", "milk", "old",
"malt", "fruit", "dark", "sweet", "alcohol", "liquor", "cream", "common", "tan", "smoked", "light")
beer_names <- beer_names[!(beer_names %in% exceptions)]
beer_names <- c(beer_names, paste(beer_names, "s", sep=""), paste(beer_names, "s", sep="'"))
beer_tidy <- beer_reviews %>%
subset(Style %in% st$Style) %>%
unnest_tokens(word, Review_Text) %>%
anti_join(stop_words) %>%
filter(!word %in% beer_names) %>%
count(word, Style) %>%
group_by(word) %>%
mutate(word_total = sum(n)) %>%
bind_tf_idf(word, Style, n)  %>%
subset(word_total >= 10 & tf_idf > 0) %>%
arrange(desc(tf_idf))
View(beer_tidy)
beer_tidy
head(beer_tidy)
beer_tidy <- beer_reviews %>%
subset(Style %in% st$Style) %>%
unnest_tokens(word, Review_Text) %>%
anti_join(stop_words) %>%
filter(!word %in% beer_names) %>%
count(word, Style) %>%
group_by(word) %>%
mutate(word_total = sum(n)) %>%
bind_tf_idf(word, Style, n)  %>%
subset(word_total >= 10 & tf_idf > 0) %>%
arrange(desc(tf_idf))
beer_tidy
head(beer_tidy, 5)
beer_corr <- beer_reviews %>%
subset(Style %in% st$Style) %>%
unnest_tokens(word, Review_Text) %>%
anti_join(stop_words) %>%
count(word, Style) %>%
group_by(Style) %>%
mutate(Prop = n / sum(n))  %>%
subset(n >= 5) %>%
select(-n) %>%
spread(Style, Prop)
setwd('/Users/kaylinpavlik/R/tidy_text_beer_reviews')
beer_reviews <- read.csv("brewery_beers_reviews.csv", stringsAsFactors=F)
setwd('/Users/kaylinpavlik/R/tidy_text_beer_reviews/data')
beer_reviews <- read.csv("brewery_beers_reviews.csv", stringsAsFactors=F)
setwd(~)
setwd(..)
setwd(.)
